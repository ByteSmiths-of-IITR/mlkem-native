# SPDX-License-Identifier: Apache-2.0

name: Set Shell
description: Setup nix or custom shell for workflows

inputs:
  nix-shell:
    description: Run in the specified Nix environment if exists. If empty, custom shell will be used instead of nix.
    default: 'ci'
  nix-cache:
    description: Determine whether to enable nix cache
    default: 'true'
  nix-verbose:
    description: Determine wether to suppress nix log or not
    default: 'false'
  custom_shell:
    description: The shell to use. Only relevant if no nix-shell specified
    default: 'bash'
  script:
    description: The script to be run in the nix shell
    required: false

runs:
  using: composite
  steps:
    - name: Setup nix
      uses: ./.github/actions/setup-nix
      if: ${{ inputs.nix-shell != '' }}
      with:
        devShell: ${{ inputs.nix-shell }}
        verbose: ${{ inputs.nix-verbose }}
        cache: ${{ inputs.nix-cache }}
        script: ${{ inputs.script }}
    - name: Set custom shell
      shell: bash
      if: ${{ inputs.nix-shell == '' }}
      run: |
          echo SHELL="${{ inputs.custom_shell }}" >> $GITHUB_ENV

          if [[ "${{ inputs.script }}" != '' ]]; then
            eval ${{ inputs.script }}
          fi
